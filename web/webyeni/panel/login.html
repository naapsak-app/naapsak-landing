<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Naapsak Panel | Giriş</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./panel.css">
</head>
<body>
  <div class="center">
    <div class="card login-card">
      <div class="brand" style="justify-content:center">
        <img src="../png/Naapsak Logo (2)-03.png" alt="Naapsak">
      </div>
      <h1 class="h1" style="text-align:center;margin-top:10px">Gizli Panel</h1>
      <p class="sub" style="text-align:center">Kullanıcı adı ve şifrenle giriş yap.</p>

      <div class="grid" style="gap:12px;margin-top:14px">
        <div class="field">
          <label for="u">Kullanıcı Adı</label>
          <input id="u" autocomplete="username" placeholder="örn: tech.clko">
        </div>
        <div class="field">
          <label for="p">Şifre</label>
          <input id="p" type="password" autocomplete="current-password" placeholder="••••••••">
        </div>
        <button class="btn primary" id="loginBtn">Giriş Yap</button>
        <div class="small" style="text-align:center">Bu sayfa menüde görünmez. URL’yi bilen erişir.</div>
        <div id="msg" class="toast"></div>
      </div>
    </div>
  </div>

  <script src="./auth.js"></script>
  <script>
    const $ = (id)=>document.getElementById(id);
    function setRole(role, username){
      localStorage.setItem('naapsak_role', role);
      localStorage.setItem('naapsak_user', username);
    }
    function goNext(role){
      window.location.href = role === 'admin' ? './admin.html' : './partner.html';
    }
    async function tryLogin(){
      const username = $('u').value.trim();
      const password = $('p').value;
      if(!username || !password) {
        $('msg').style.color = '#ffb03c';
        $('msg').textContent = 'Kullanıcı adı ve şifre gerekli.';
        return;
      }
      if (typeof window.naapsakAuthVerify === 'function') {
        const res = await window.naapsakAuthVerify(username, password);
        if(!res || !res.ok){
          $('msg').style.color = '#ff5a5a';
          $('msg').textContent = 'Hatalı kullanıcı / şifre.';
          return;
        }
        setRole(res.role, username);
        goNext(res.role);
        return;
      }
      $('msg').style.color = '#ff5a5a';
      $('msg').textContent = 'Auth yapılandırması bulunamadı (auth.js).';
    }
    $('loginBtn').addEventListener('click', tryLogin);
    $('p').addEventListener('keydown', (e)=>{ if(e.key==='Enter') tryLogin(); });
  </script>
</body>
</html>
